import{af as i,ag as c,a7 as o}from"./index-DnKsfOj5.js";class u{static async submitMessage(e){try{const t=await i(),r=await c(),s={name:e.name,email:e.email,subject:e.subject,message:e.message,phone_number:e.phoneNumber||null,consent:e.consent??!0,marketing_consent:e.marketingConsent??!1,referral_source:document.referrer||null,status:"new",priority:"normal",category:"general",utm_source:this.getUTMParameter("utm_source"),utm_medium:this.getUTMParameter("utm_medium"),utm_campaign:this.getUTMParameter("utm_campaign"),utm_term:this.getUTMParameter("utm_term"),utm_content:this.getUTMParameter("utm_content"),user_agent:navigator.userAgent,screen_resolution:`${screen.width}x${screen.height}`,language:navigator.language,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,browser:t.browser,browser_version:t.browserVersion,os:t.os,os_version:t.osVersion,device_name:t.deviceName,device_model:t.deviceModel,device_manufacturer:t.deviceManufacturer,device_type:t.deviceType,is_mobile:t.deviceType==="mobile",is_tablet:t.deviceType==="tablet",is_desktop:t.deviceType==="desktop",ip_address:r.ip,country:r.country,city:r.city,state:r.state,latitude:r.latitude,longitude:r.longitude,scroll_depth:this.getScrollDepth(),time_on_page:this.getTimeOnPage(),referrer:document.referrer,landing_page:window.location.href,session_id:this.getSessionId(),page_load_time:this.getPageLoadTime(),network_speed:t.networkSpeed,connection_type:t.connectionType,cpu_cores:t.cpuCores,memory_gb:t.memoryGb,color_depth:screen.colorDepth,pixel_ratio:window.devicePixelRatio,viewport_width:window.innerWidth,viewport_height:window.innerHeight,touch_support:"ontouchstart"in window,webgl_support:this.checkWebGLSupport(),cookie_enabled:navigator.cookieEnabled,do_not_track:navigator.doNotTrack==="1",ad_blocker_detected:this.detectAdBlocker(),javascript_enabled:!0,flash_enabled:this.checkPluginSupport("Shockwave Flash"),java_enabled:navigator.javaEnabled(),silverlight_enabled:this.checkPluginSupport("Silverlight"),pdf_viewer:this.getPDFViewer(),quicktime_enabled:this.checkPluginSupport("QuickTime"),realplayer_enabled:this.checkPluginSupport("RealPlayer"),windowsmedia_enabled:this.checkPluginSupport("Windows Media Player"),vlc_enabled:this.checkPluginSupport("VLC"),shockwave_enabled:this.checkPluginSupport("Shockwave"),activex_enabled:this.checkActiveXSupport(),vbs_enabled:!1,vb_enabled:!1,perl_enabled:!1,python_enabled:!1,ruby_enabled:!1,php_enabled:!1,asp_enabled:!1,jsp_enabled:!1,coldfusion_enabled:!1,cgi_enabled:!1,isp:r.isp,organization:r.organization,as_number:r.asNumber,proxy_detected:!1,vpn_detected:!1,tor_detected:!1,bot_detected:this.detectBot(),fraud_score:this.calculateFraudScore(t,r),risk_level:"low",engagement_score:this.calculateEngagementScore(),conversion_probability:.5},{data:n,error:a}=await o.from("contact_messages").insert([s]).select().single();return a?(console.error("Error submitting contact message:",a),{success:!1,error:a.message}):{success:!0,data:n}}catch(t){return console.error("Unexpected error submitting contact message:",t),{success:!1,error:t instanceof Error?t.message:"Unknown error occurred"}}}static getUTMParameter(e){return new URLSearchParams(window.location.search).get(e)}static getScrollDepth(){const e=window.pageYOffset||document.documentElement.scrollTop,t=document.documentElement.scrollHeight-window.innerHeight;return t>0?Math.round(e/t*100):0}static getTimeOnPage(){return Math.floor(Math.random()*300)+30}static getSessionId(){let e=sessionStorage.getItem("contact_session_id");return e||(e="session_"+Date.now()+"_"+Math.random().toString(36).substr(2,9),sessionStorage.setItem("contact_session_id",e)),e}static getPageLoadTime(){if(performance&&performance.timing){const e=performance.timing.loadEventEnd-performance.timing.navigationStart;return e>0?e:0}return 0}static checkWebGLSupport(){try{const e=document.createElement("canvas");return!!(window.WebGLRenderingContext&&(e.getContext("webgl")||e.getContext("experimental-webgl")))}catch{return!1}}static checkPluginSupport(e){if(navigator.plugins){for(let t=0;t<navigator.plugins.length;t++)if(navigator.plugins[t].name.indexOf(e)!==-1)return!0}return!1}static getPDFViewer(){if(navigator.plugins)for(let e=0;e<navigator.plugins.length;e++){const t=navigator.plugins[e];if(t.name.toLowerCase().includes("pdf")||t.description.toLowerCase().includes("pdf"))return t.name}return null}static checkActiveXSupport(){try{return!!("ActiveXObject"in window||window.ActiveXObject)}catch{return!1}}static detectAdBlocker(){try{const e=document.createElement("div");e.innerHTML="&nbsp;",e.className="adsbox",document.body.appendChild(e);const t=e.offsetHeight===0;return document.body.removeChild(e),t}catch{return!1}}static detectBot(){const e=[/bot/i,/crawler/i,/spider/i,/scraper/i,/crawling/i,/googlebot/i,/bingbot/i,/slurp/i,/duckduckbot/i],t=navigator.userAgent;return e.some(r=>r.test(t))}static calculateFraudScore(e,t){let r=0;return t.vpnDetected&&(r+=20),t.proxyDetected&&(r+=15),t.torDetected&&(r+=30),this.detectBot()&&(r+=40),(!e.browser||e.browser==="Unknown")&&(r+=10),(!e.os||e.os==="Unknown")&&(r+=10),Math.min(r,100)}static calculateEngagementScore(){let e=50;const t=this.getScrollDepth();t>80?e+=20:t>50&&(e+=10);const r=this.getTimeOnPage();return r>300?e+=20:r>120&&(e+=10),navigator.userAgent.includes("Mobile")&&(e+=5),Math.min(e,100)}static async getAllMessages(){try{const{data:e,error:t}=await o.from("contact_messages").select("*").order("created_at",{ascending:!1});return t?{data:null,error:t.message}:{data:e,error:null}}catch(e){return{data:null,error:e instanceof Error?e.message:"Unknown error occurred"}}}static async updateMessageStatus(e,t,r,s){try{const n={status:t};r&&(n.priority=r),s&&(n.notes=s),n.updated_at=new Date().toISOString();const{error:a}=await o.from("contact_messages").update(n).eq("id",e);return a?{success:!1,error:a.message}:{success:!0}}catch(n){return{success:!1,error:n instanceof Error?n.message:"Unknown error occurred"}}}}export{u as ContactMessageService};
//# sourceMappingURL=contactMessageService-5g2rfCVy.js.map
